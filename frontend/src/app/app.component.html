<!-- Skip Navigation Links -->
<app-skip-navigation></app-skip-navigation>

<!-- Header con branding y navegación -->
<mat-toolbar color="primary" class="app-toolbar" id="main-navigation" role="banner">
  <button
    mat-icon-button
    (click)="toggleSidenav()"
    class="menu-button"
    matTooltip="Menú"
    aria-label="Alternar menú de navegación"
    [attr.aria-expanded]="!isMobile ? !isCollapsed : sidenav?.opened">
    <mat-icon aria-hidden="true">{{ isMobile || !isCollapsed ? 'menu' : 'menu_open' }}</mat-icon>
  </button>

  <div class="toolbar-brand">
    <mat-icon class="brand-icon" aria-hidden="true">security</mat-icon>
    <span class="brand-title">{{ title }}</span>
  </div>

  <span class="spacer"></span>

  <!-- Acciones rápidas en header -->
  <button
    mat-icon-button
    matTooltip="Notificaciones"
    class="header-action"
    aria-label="Ver notificaciones">
    <mat-icon aria-hidden="true">notifications</mat-icon>
  </button>

  <button
    mat-icon-button
    matTooltip="Configuración"
    class="header-action"
    aria-label="Abrir configuración">
    <mat-icon aria-hidden="true">settings</mat-icon>
  </button>

  <button
    mat-icon-button
    [matMenuTriggerFor]="userMenu"
    matTooltip="Perfil de usuario"
    class="user-button"
    aria-label="Abrir menú de usuario"
    [attr.aria-expanded]="userMenu">
    <mat-icon aria-hidden="true">account_circle</mat-icon>
  </button>
</mat-toolbar>

<!-- Contenedor principal con sidebar -->
<mat-sidenav-container class="sidenav-container" [class.mobile]="isMobile">
  <mat-sidenav
    #sidenav
    [mode]="isMobile ? 'over' : 'side'"
    [opened]="!isMobile"
    [fixedInViewport]="isMobile"
    [class.collapsed]="isCollapsed && !isMobile"
    class="app-sidenav">

    <!-- Logo/Brand en sidebar -->
    <div class="sidebar-header" *ngIf="!isCollapsed || isMobile">
      <mat-icon class="sidebar-logo">shield</mat-icon>
      <div class="sidebar-title">
        <h2>Soriano</h2>
        <p>Mediadores</p>
      </div>
    </div>

    <!-- Navigation menu -->
    <mat-nav-list class="nav-list" role="navigation" aria-label="Menú principal">
      <a
        mat-list-item
        *ngFor="let item of menuItems"
        [routerLink]="item.path"
        routerLinkActive="active-link"
        (click)="closeSidenavOnMobile()"
        [matTooltip]="isCollapsed && !isMobile ? item.tooltip : ''"
        matTooltipPosition="right"
        [attr.aria-label]="item.tooltip"
        class="nav-item">
        <mat-icon matListItemIcon class="nav-icon" aria-hidden="true">{{ item.icon }}</mat-icon>
        <span matListItemTitle class="nav-label" *ngIf="!isCollapsed || isMobile">
          {{ item.label }}
        </span>
      </a>
    </mat-nav-list>

    <!-- Footer en sidebar -->
    <div class="sidebar-footer" *ngIf="!isCollapsed || isMobile">
      <mat-divider></mat-divider>
      <div class="footer-content">
        <p class="footer-text">CRM Soriano Mediadores</p>
        <p class="footer-year">© {{ currentYear }}</p>
      </div>
    </div>
  </mat-sidenav>

  <!-- Contenido principal -->
  <mat-sidenav-content class="main-content">
    <div class="content-wrapper" id="main-content" role="main" tabindex="-1">
      <router-outlet></router-outlet>
    </div>

    <!-- Footer principal (visible en contenido) -->
    <footer class="main-footer">
      <div class="footer-container">
        <div class="footer-section">
          <p>Soriano Mediadores - Sistema CRM</p>
          <p class="footer-small">Gestión integral de seguros</p>
        </div>
        <div class="footer-section">
          <p class="footer-small">© {{ currentYear }} Todos los derechos reservados</p>
        </div>
      </div>
    </footer>
  </mat-sidenav-content>
</mat-sidenav-container>

<!-- Menu dropdown de usuario -->
<mat-menu #userMenu="matMenu">
  <div class="user-menu-header" *ngIf="currentUser$ | async as user">
    <p class="user-name">{{ user.nombre }}</p>
    <p class="user-role">{{ user.role }}</p>
  </div>
  <mat-divider></mat-divider>
  <button mat-menu-item (click)="navigateToProfile()">
    <mat-icon>person</mat-icon>
    <span>Mi Perfil</span>
  </button>
  <button mat-menu-item (click)="navigateToSettings()">
    <mat-icon>settings</mat-icon>
    <span>Configuración</span>
  </button>
  <mat-divider></mat-divider>
  <button mat-menu-item (click)="logout()">
    <mat-icon>logout</mat-icon>
    <span>Cerrar Sesión</span>
  </button>
</mat-menu>
